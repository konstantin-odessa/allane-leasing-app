<mat-card class="relative">
  <mat-card-header class="flex justify-center">
    <mat-card-title>Create new contract</mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <mat-stepper
      [formGroup]="contractFormGroup"
      orientation="vertical"
      #stepper>
      <mat-step [stepControl]="contractFormGroup.controls.monthlyRate">
        <form>
          <ng-template matStepLabel>Set monthly rate</ng-template>
          <mat-form-field appearance="fill">
            <mat-label>Monthly rate:</mat-label>
            <input
              type="number"
              matInput
              formControlName="monthlyRate"
              required />
          </mat-form-field>
          <div>
            <button mat-button matStepperNext>Next</button>
          </div>
        </form>
      </mat-step>
      <mat-step [stepControl]="contractFormGroup.controls.vehicle">
        <form>
          <ng-template matStepLabel>Select vehicle</ng-template>
          <mat-form-field>
            <mat-label>Select vehicle</mat-label>
            <mat-select (selectionChange)="changeVehicle($event)">
              <mat-option
                *ngFor="let vehicle of vehicles$ | async"
                [value]="vehicle.id">
                {{ vehicle | vehicleOutput }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-expansion-panel [expanded]="!!selectedVehicleId">
            <app-edit-vehicle-details
              (vehicleLoaded)="onVehicleLoaded($event)"
              [vehicleId]="selectedVehicleId"
              [isStandalone]="false"></app-edit-vehicle-details>
          </mat-expansion-panel>
          <div>
            <button mat-button matStepperPrevious>Back</button>
            <button mat-button matStepperNext>Next</button>
          </div>
        </form>
      </mat-step>
      <mat-step [stepControl]="contractFormGroup.controls.customer">
        <form>
          <ng-template matStepLabel>Select customer</ng-template>
          <mat-form-field>
            <mat-label>Select customer</mat-label>
            <mat-select (selectionChange)="changeCustomer($event)">
              <mat-option
                *ngFor="let customer of customers$ | async"
                [value]="customer.id">
                {{ customer.firstName + ' ' + customer.lastName }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-expansion-panel [expanded]="!!selectedCustomerId">
            <app-edit-customer-details
              (customerLoaded)="onCustomerLoaded($event)"
              [customerId]="selectedCustomerId"
              [isStandalone]="false"></app-edit-customer-details>
          </mat-expansion-panel>

          <div>
            <button mat-button matStepperPrevious>Back</button>
          </div>
        </form>
      </mat-step>
    </mat-stepper>
  </mat-card-content>

  <mat-card-actions class="flex justify-end">
    <button
      (click)="createContract()"
      [disabled]="!contractFormGroup.valid"
      mat-raised-button
      color="accent">
      Create contract
    </button>
  </mat-card-actions>

  <div *ngIf="isLoading" class="loading-cloak">
    <mat-spinner></mat-spinner>
  </div>
</mat-card>
